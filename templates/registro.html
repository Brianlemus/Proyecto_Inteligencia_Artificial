<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center mb-4">Registro de Usuario</h2>
        <form method="POST" action="/registro" class="col-md-6 offset-md-3">

            <label class="form-label">Nombre completo</label>
            <input class="form-control mb-3" name="nombre" required>

            <label class="form-label">Correo electrónico</label>
            <input class="form-control mb-3" name="correo" type="email" required>

            <label class="form-label">Contraseña</label>
            <input class="form-control mb-3" name="clave" type="password" required>

            <label class="form-label">Rol</label>
            <select class="form-control mb-3" name="rol">
                {% for rol in roles %}
                    <option>{{ rol }}</option>
                {% endfor %}
            </select>

            <label class="form-label">Puesto</label>
            <select class="form-control mb-3" name="puesto">
                {% for puesto in puestos %}
                    <option>{{ puesto }}</option>
                {% endfor %}
            </select>

            <h5 class="text-center mt-4">Datos de la Casa</h5>

            <label class="form-label">Seleccionar casa</label>
            <select class="form-control mb-3" id="selectorCasa" name="selectorCasa" onchange="cargarCasa()">
                <option value="">Asignar casa</option>
                {% for casa in casas %}
                    <option value="{{ casa['id'] }}">{{ casa['nombre_casa'] }}</option>
                {% endfor %}
            </select>

            <label class="form-label">Dirección</label>
            <input class="form-control mb-2" name="direccion" id="direccion" required>

            <label class="form-label">Número</label>
            <input class="form-control mb-2" name="numero" id="numero" required>

            <label class="form-label">Letra</label>
            <input class="form-control mb-2" name="letra" id="letra" required>

            <label class="form-label">Teléfono</label>
            <input class="form-control mb-2" name="telefono" id="telefono" required>

            <label class="form-label">Nombre de la Casa</label>
            <input class="form-control mb-2" name="nombre_casa" id="nombre_casa" required>

            {% if error %}
                <div class="alert alert-danger mt-3">{{ error }}</div>
            {% endif %}

            <div class="d-grid gap-2 mt-4">
                <button class="btn btn-success">Registrar</button>
                <a href="/" class="btn btn-secondary">Regresar al Login</a>
            </div>
        </form>
    </div>

    <!-- ✔ Script debe estar dentro del body -->
    <script>
        const casas = {{ casas | tojson }};

        function cargarCasa() {
            const idSeleccionado = document.getElementById("selectorCasa").value;
            const direccion = document.getElementById("direccion");
            const numero = document.getElementById("numero");
            const letra = document.getElementById("letra");
            const telefono = document.getElementById("telefono");
            const nombre_casa = document.getElementById("nombre_casa");

            if (idSeleccionado === "") {
                direccion.value = "";
                numero.value = "";
                letra.value = "";
                telefono.value = "";
                nombre_casa.value = "";
                direccion.readOnly = false;
                numero.readOnly = false;
                letra.readOnly = false;
                telefono.readOnly = false;
                nombre_casa.readOnly = false;
                return;
            }

            const casa = casas.find(c => c.id === idSeleccionado);
            if (casa) {
                direccion.value = casa.direccion;
                numero.value = casa.numero;
                letra.value = casa.letra;
                telefono.value = casa.telefono;
                nombre_casa.value = casa.nombre_casa;

                direccion.readOnly = true;
                numero.readOnly = true;
                letra.readOnly = true;
                telefono.readOnly = true;
                nombre_casa.readOnly = true;
            }
        }
    </script>
</body>
</html>
